{
  "planId": "recovery-fix-breaking-changes",
  "problem": "Fix breaking changes from Phase 1 parallel execution: CookieHandler API changes broke 25 tests, need to restore compatibility and verify all 362 tests pass",
  "status": "in-progress",
  "iteration": 2,
  "maxIterations": 6,
  "sessionId": "11e6fc79-104b-4414-9339-a85842518c6d",
  "parentQueue": "queue_20251029_222500.json",
  "createdAt": "2025-10-29T23:10:00Z",
  "tasks": [
    {
      "id": "recovery-001",
      "title": "Fix CookieHandler constructor backward compatibility",
      "description": "CRITICAL: CookieHandler constructor changed from CookieHandler(settings) to CookieHandler({settings, logger}). This broke 25 tests. Fix by supporting BOTH signatures: (1) new CookieHandler(settings) - legacy, (2) new CookieHandler({settings, logger}) - new. Check if first arg is ABSmartlySettings object or options object.",
      "status": "pending",
      "assignedTo": null,
      "agentType": "principal-dev",
      "priority": 1,
      "relatedFiles": ["src/core/cookie-handler.ts", "tests/unit/core/cookie-handler.test.ts"],
      "dependencies": [],
      "result": null,
      "startedAt": null,
      "completedAt": null
    },
    {
      "id": "recovery-002",
      "title": "Update setup-managers.ts to use new CookieHandler API",
      "description": "Update createCoreManagers() in setup-managers.ts:35 to pass {settings, logger} to CookieHandler constructor. This is the correct new API after backward compat is restored.",
      "status": "pending",
      "assignedTo": null,
      "agentType": "principal-dev",
      "priority": 1,
      "relatedFiles": ["src/shared/setup-managers.ts"],
      "dependencies": ["recovery-001"],
      "result": null,
      "startedAt": null,
      "completedAt": null
    },
    {
      "id": "recovery-003",
      "title": "Fix OverridesHandler constructor to accept optional logger",
      "description": "OverridesHandler constructor was changed to require logger parameter. Make it optional to maintain backward compatibility. Update setup-managers.ts:36 to pass logger if available.",
      "status": "pending",
      "assignedTo": null,
      "agentType": "principal-dev",
      "priority": 1,
      "relatedFiles": ["src/core/overrides-handler.ts", "src/shared/setup-managers.ts"],
      "dependencies": [],
      "result": null,
      "startedAt": null,
      "completedAt": null
    },
    {
      "id": "recovery-004",
      "title": "Verify all 362 tests pass after compatibility fixes",
      "description": "Run npm test and verify all 362 tests pass (was 313 before, increased to 362 with new XSS tests). Ensure 0 regressions. Focus on cookie-handler.test.ts (25 tests) that were failing.",
      "status": "pending",
      "assignedTo": null,
      "agentType": "test-automation",
      "priority": 1,
      "relatedFiles": [],
      "dependencies": ["recovery-001", "recovery-002", "recovery-003"],
      "result": null,
      "startedAt": null,
      "completedAt": null
    },
    {
      "id": "recovery-005",
      "title": "Document backend-architect changes that were completed",
      "description": "Review and document what Worker-2 (backend-architect) actually completed: TTL cache, circuit breaker, race condition fixes, cookie security. Update queue_20251029_222500.json to mark tasks 003-009 with proper status based on actual file changes.",
      "status": "pending",
      "assignedTo": null,
      "agentType": "principal-dev",
      "priority": 2,
      "relatedFiles": [".claude/tasks/queue_20251029_222500.json", "src/core/context-manager.ts", "src/core/sdk-injector.ts", "src/core/cookie-handler.ts"],
      "dependencies": ["recovery-004"],
      "result": null,
      "startedAt": null,
      "completedAt": null
    },
    {
      "id": "recovery-006",
      "title": "Create git commits for completed Phase 1 work",
      "description": "Create separate commits: (1) XSS fixes + tests (tasks 001, 002), (2) Error logging improvements (task 007), (3) Selector validation (task 010), (4) Event listener cleanup (task 006), (5) Backend architecture improvements (tasks 003-005, 008-009), (6) Test suite fixes. Use conventional commit format.",
      "status": "pending",
      "assignedTo": null,
      "agentType": "principal-dev",
      "priority": 2,
      "relatedFiles": [],
      "dependencies": ["recovery-004", "recovery-005"],
      "result": null,
      "startedAt": null,
      "completedAt": null
    },
    {
      "id": "recovery-007",
      "title": "Update IMPROVEMENTS.md with Phase 1 results",
      "description": "Add Phase 1 Critical Fixes section to IMPROVEMENTS.md. Document: (1) 3 critical security vulnerabilities fixed (XSS x2, selector injection), (2) 5 critical performance issues fixed (cache TTL, race condition, event cleanup, circuit breaker, error logging), (3) Test suite expanded from 313 to 362 tests, (4) All tests passing, (5) Code quality maintained at 8.8/10.",
      "status": "pending",
      "assignedTo": null,
      "agentType": "principal-dev",
      "priority": 2,
      "relatedFiles": ["IMPROVEMENTS.md"],
      "dependencies": ["recovery-006"],
      "result": null,
      "startedAt": null,
      "completedAt": null
    },
    {
      "id": "recovery-008",
      "title": "Update session context with Phase 1 completion",
      "description": "Update .claude/tasks/context_session_11e6fc79-104b-4414-9339-a85842518c6d.md with Phase 1 completion summary: tasks completed, issues fixed, test results, commits created, lessons learned from parallel execution.",
      "status": "pending",
      "assignedTo": null,
      "agentType": "principal-dev",
      "priority": 3,
      "relatedFiles": [".claude/tasks/context_session_11e6fc79-104b-4414-9339-a85842518c6d.md"],
      "dependencies": ["recovery-007"],
      "result": null,
      "startedAt": null,
      "completedAt": null
    }
  ]
}
